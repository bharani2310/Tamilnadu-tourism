{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/bhara/OneDrive/Documents/GitHub/TN/Tamilnadu-tourism/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/bhara/OneDrive/Documents/GitHub/TN/Tamilnadu-tourism/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/bhara/OneDrive/Documents/GitHub/TN/Tamilnadu-tourism/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState,useEffect}from'react';import{Container,Row,Col}from'reactstrap';import NewsLetter from'../shared/Newsletter';import FeaturedTourList from'../components/Featured-tours/FeaturedTourList';import Subtitle from'../shared/Subtitle';import{BASE_URL}from'../utils/config';import{AuthContext}from'../context/AuthContext';import'./../styles/dashboard.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var BookingList=function BookingList(){var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),bookings=_useState2[0],setBookings=_useState2[1];useEffect(function(){var fetchBookings=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var response,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(BASE_URL,\"/booking/\").concat(user.data._id));case 3:response=_context.sent;if(response.ok){_context.next=6;break;}throw new Error('Failed to fetch bookings');case 6:_context.next=8;return response.json();case 8:data=_context.sent;setBookings(data.data);console.log('Data : ',data.data);_context.next=16;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.error('Error fetching bookings:',_context.t0);case 16:case\"end\":return _context.stop();}},_callee,null,[[0,13]]);}));return function fetchBookings(){return _ref.apply(this,arguments);};}();fetchBookings();},[user.data._id]);var updateBooking=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(id,updatedFields){var res,data;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return fetch(\"\".concat(BASE_URL,\"/booking/\").concat(id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(updatedFields)});case 3:res=_context2.sent;console.log(\"Updated Fields\",updatedFields);_context2.next=7;return res.json();case 7:data=_context2.sent;console.log(\"data\",data);if(res.ok){_context2.next=11;break;}throw new Error(data.message);case 11:window.alert(\"Updated Successfully\");console.log(\"Booking updated successfully:\",data);_context2.next=18;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);console.error(\"Error updating booking:\",_context2.t0);case 18:case\"end\":return _context2.stop();}},_callee2,null,[[0,15]]);}));return function updateBooking(_x,_x2){return _ref2.apply(this,arguments);};}();var handleUpdate=function handleUpdate(id){var updatedFields={};var fullName=window.prompt(\"Enter the new full name:\");var bookAt=window.prompt(\"Enter the new tour Date:\");var guestSize=window.prompt(\"Enter the Number of Passengers:\");if(fullName!==null&&fullName!==''){updatedFields.fullName=fullName;}if(bookAt!==null&&bookAt!==''){updatedFields.bookAt=bookAt;}if(guestSize!==null&&guestSize!==''){updatedFields.guestSize=guestSize;}if(Object.keys(updatedFields).length>0){updateBooking(id,updatedFields);}else{alert(\"No changes were made.\");}};var handleCancel=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(id){var res,result;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:console.log(\"this is the deleted id:\",id);_context3.prev=1;_context3.next=4;return fetch(\"\".concat(BASE_URL,\"/booking/\").concat(id),{method:'DELETE',headers:{'content-type':'application/json'},credentials:'include'});case 4:res=_context3.sent;_context3.next=7;return res.json();case 7:result=_context3.sent;if(res.ok){_context3.next=10;break;}return _context3.abrupt(\"return\",alert(result.message));case 10:window.alert(\"Cancelled Successfully...\");_context3.next=16;break;case 13:_context3.prev=13;_context3.t0=_context3[\"catch\"](1);alert(_context3.t0.message);case 16:case\"end\":return _context3.stop();}},_callee3,null,[[1,13]]);}));return function handleCancel(_x3){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(Subtitle,{subtitle:'My Bookings'}),/*#__PURE__*/_jsx(Container,{children:bookings.length>0?/*#__PURE__*/_jsxs(\"table\",{className:\"booking-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"User Email\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Full Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Tour Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"No.of.Passengers\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Booked At\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:bookings.map(function(booking){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:booking.userEmail}),/*#__PURE__*/_jsx(\"td\",{children:booking.fullName}),/*#__PURE__*/_jsx(\"td\",{children:booking.tourName}),/*#__PURE__*/_jsx(\"td\",{children:booking.guestSize}),/*#__PURE__*/_jsx(\"td\",{children:booking.bookAt}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn booking__btn\",onClick:function onClick(){return handleUpdate(booking._id);},children:\"Update\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn booking__cancel-btn\",onClick:function onClick(){return handleCancel(booking._id);},children:\"Cancel\"})]})]},booking._id);})})]}):/*#__PURE__*/_jsx(\"p\",{children:\"No bookings found\"})})]});};var Dashboard=function Dashboard(){return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"section\",{children:[/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsxs(Col,{lg:\"12\",className:\"mb-5\",children:[/*#__PURE__*/_jsx(BookingList,{}),/*#__PURE__*/_jsx(Subtitle,{subtitle:'Recommendations'}),/*#__PURE__*/_jsx(\"h2\",{className:\"featured__tour-title\",children:\"Our Best Featured Tours\"})]}),/*#__PURE__*/_jsx(FeaturedTourList,{})]})}),/*#__PURE__*/_jsx(NewsLetter,{})]})});};export default Dashboard;","map":{"version":3,"names":["React","useContext","useState","useEffect","Container","Row","Col","NewsLetter","FeaturedTourList","Subtitle","BASE_URL","AuthContext","BookingList","user","bookings","setBookings","fetchBookings","fetch","data","_id","response","ok","Error","json","console","log","error","updateBooking","id","updatedFields","method","headers","body","JSON","stringify","res","message","window","alert","handleUpdate","fullName","prompt","bookAt","guestSize","Object","keys","length","handleCancel","credentials","result","map","booking","userEmail","tourName","Dashboard"],"sources":["C:/Users/bhara/OneDrive/Documents/GitHub/TN/Tamilnadu-tourism/frontend/src/pages/Dashboard.jsx"],"sourcesContent":["import React, { useContext, useState, useEffect } from 'react';\r\nimport { Container, Row, Col } from 'reactstrap';\r\nimport NewsLetter from '../shared/Newsletter';\r\nimport FeaturedTourList from '../components/Featured-tours/FeaturedTourList';\r\nimport Subtitle from '../shared/Subtitle';\r\nimport { BASE_URL } from '../utils/config';\r\nimport { AuthContext } from '../context/AuthContext';\r\nimport './../styles/dashboard.css'\r\n\r\n\r\n\r\nconst BookingList = () => {\r\nconst {user} = useContext(AuthContext)\r\nconst [bookings, setBookings] = useState([]);\r\n\r\n\r\n  useEffect(() => {\r\n    const fetchBookings = async () => {\r\n        try {\r\n            const response= await fetch(`${BASE_URL}/booking/${user.data._id}`);\r\n            if (!response.ok) {\r\n                throw new Error('Failed to fetch bookings');\r\n            }\r\n            const data = await response.json();\r\n            setBookings(data.data);\r\n            console.log('Data : ',data.data)\r\n\r\n        } catch (error) {\r\n            console.error('Error fetching bookings:', error);\r\n        }\r\n    };\r\n    fetchBookings();\r\n}, [user.data._id]); \r\n\r\n\r\nconst updateBooking = async (id, updatedFields) => {\r\n  try {\r\n      const res = await fetch(`${BASE_URL}/booking/${id}`, {\r\n          method: 'PUT',\r\n          headers: {\r\n              'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify(updatedFields)\r\n      });\r\n      console.log(\"Updated Fields\",updatedFields)\r\n      const data = await res.json();\r\n      console.log(\"data\",data)\r\n      if (!res.ok) {\r\n          throw new Error(data.message);\r\n      }\r\n      window.alert(\"Updated Successfully\")\r\n      console.log(\"Booking updated successfully:\", data);\r\n  } catch (error) {\r\n      console.error(\"Error updating booking:\", error);\r\n  }\r\n};\r\n\r\n\r\nconst handleUpdate = (id) => {\r\n  const updatedFields = {};\r\n  const fullName = window.prompt(\"Enter the new full name:\");\r\n  const bookAt = window.prompt(\"Enter the new tour Date:\");\r\n  const guestSize = window.prompt(\"Enter the Number of Passengers:\");\r\n  \r\n\r\n  if (fullName !== null && fullName !== '') {\r\n      updatedFields.fullName = fullName;\r\n  }\r\n  if (bookAt !== null && bookAt !== '') {\r\n      updatedFields.bookAt = bookAt;\r\n  }\r\n  if (guestSize !== null && guestSize !== '') {\r\n      updatedFields.guestSize = guestSize;\r\n  }\r\n  \r\n\r\n  if (Object.keys(updatedFields).length > 0) {\r\n      updateBooking(id, updatedFields);\r\n  } else {\r\n      alert(\"No changes were made.\");\r\n  }\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst handleCancel = async (id) => {\r\n\r\n  console.log(\"this is the deleted id:\",id)\r\n\r\n  try {\r\n    const res = await fetch(`${BASE_URL}/booking/${id}`, {\r\n      method: 'DELETE',\r\n      headers: {\r\n          'content-type': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n  });\r\n  const result = await res.json();\r\n  if (!res.ok) {\r\n      return alert(result.message);\r\n  }\r\n  window.alert(\"Cancelled Successfully...\")\r\n  \r\n\r\n  \r\n  } catch (err) {\r\n    alert(err.message)\r\n  }\r\n};\r\n\r\nreturn (\r\n  \r\n  <section>\r\n  <Subtitle subtitle={'My Bookings'}/>\r\n  <Container>\r\n    {bookings.length > 0 ? (\r\n      <table className=\"booking-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>User Email</th>\r\n            <th>Full Name</th>\r\n            <th>Tour Name</th>\r\n            <th>No.of.Passengers</th>\r\n            <th>Booked At</th>\r\n            <th>Actions</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {bookings.map((booking) => (\r\n            <tr key={booking._id}>\r\n              <td>{booking.userEmail}</td>\r\n              <td>{booking.fullName}</td>\r\n              <td>{booking.tourName}</td>\r\n              <td>{booking.guestSize}</td>\r\n              <td>{booking.bookAt}</td>\r\n              <td>\r\n                <button className='btn booking__btn' onClick={() => handleUpdate(booking._id)}>Update</button>\r\n                <button className='btn booking__cancel-btn' onClick={() => handleCancel(booking._id)}>Cancel</button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n    ) : (\r\n      <p>No bookings found</p>\r\n    )}\r\n  </Container>\r\n</section>\r\n\r\n\r\n\r\n  );\r\n\r\n  \r\n};\r\n\r\nconst Dashboard = () => {\r\n  return <>\r\n\r\n    <section>\r\n    <Container>\r\n        <Row>\r\n          <Col lg='12' className='mb-5'>\r\n            <BookingList/>\r\n            <Subtitle subtitle={'Recommendations'} />\r\n            <h2 className='featured__tour-title'>Our Best Featured Tours</h2>\r\n          </Col>\r\n          <FeaturedTourList />\r\n        </Row>\r\n      </Container>\r\n\r\n      <NewsLetter />\r\n    </section>\r\n\r\n\r\n\r\n    \r\n\r\n    \r\n    </>\r\n};\r\n\r\nexport default Dashboard;\r\n\r\n\r\n\r\n\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}